<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>扁平数据结构转tree</title>
</head>

<body>
  <script>
    console.log(!!'false')
    console.log(!!'true' == !!'false')
    const arr = [{
        id: 1,
        name: '部门1',
        pid: 0
      },
      {
        id: 2,
        name: '部门2',
        pid: 1
      },
      {
        id: 3,
        name: '部门3',
        pid: 1
      },
      {
        id: 4,
        name: '部门4',
        pid: 3
      },
      {
        id: 5,
        name: '部门5',
        pid: 4
      },
      {
        id: 6,
        name: '部门5',
        pid: 5
      },
    ]

    const bpArr = [];
    let pidArr = []

    const test = (arr, item) => {
      if (!arr) return;
      arr.forEach(bt => {
        if (bt.id === item.pid) {
          if (!bt.children) bt.children = []
          bt.children.push(item)
          pidArr = [...new Set([item.id, ...pidArr])]
        } else {
          test(bt.children, item)
        }
      })
    }
    arr.map(item => {
      if (!pidArr.includes(item.pid)) {
        pidArr.push(item.id)
        bpArr.push({
          ...item,
          children: []
        });
      } else {
        test(bpArr, item)
      }
    })

    console.log('pidArr', pidArr);
    console.log('bpArr', bpArr);


    /************************************************************* */
    function arrayToTree(items) {
      const result = []; // 存放结果集
      const itemMap = {}; // 
      for (const item of items) {
        const {
          id,
          pid
        } = item;

        if (!itemMap[id]) {
          itemMap[id] = {
            children: [],
          }
        }

        itemMap[id] = {
          ...item,
          children: itemMap[id]['children']
        }

        const treeItem = itemMap[id];

        if (pid === 0) {
          result.push(treeItem);
        } else {
          if (!itemMap[pid]) {
            itemMap[pid] = {
              children: [],
            }
          }
          itemMap[pid].children.push(treeItem)
        }

      }
      return result;
    }
    console.log('arrayToTree:::::', arrayToTree(arr));
  </script>
</body>

</html>